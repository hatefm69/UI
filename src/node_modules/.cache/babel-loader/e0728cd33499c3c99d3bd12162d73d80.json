{"ast":null,"code":"var _jsxFileName = \"D:\\\\Projects\\\\React\\\\AMLS\\\\src\\\\sections\\\\dynamicForm\\\\dynamicFormSection.js\";\nimport React from \"react\";\nimport DynamicControlSection from '../dynamicForm/dynamicControlSection';\nimport { Card, Delimiter, Helpers, CellContainer, Table } from \"core\";\nimport NotificationSystem from 'react-notification-system';\nimport Item from '../../models/item';\nimport Constants from '../../utils/constants';\nimport TableItem from '../../models/tableItem';\nimport RecordState from '../../models/recordState';\nimport DynamicFormItem from '../../models/dynamicFormItem';\nimport DynamicFormData from '../../models/dynamicFormData';\nimport { GetUrl, HandleError, ConvertEpochToGregorianDate } from '../../utils/generals';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst UID_Name = 'Record_Unique_Id';\nconst FormsData_Key = 'FormsData';\nconst TableRows_Key = 'TableRows';\nconst UpdateKey_Key = 'updateKey';\nconst ReviseRecordId_Key = \"ReviseRecordId\";\nconst SelectedCityList_Key = \"SelectedCityList\";\nexport default class DynamicFormSection extends React.Component {\n  // Constructor\n  constructor(props) {\n    super(props);\n    this.state = {\n      updateKey: 1,\n      FormsData: new DynamicFormData(this.props.requestId, this.props.formId, []),\n      SaveButtonEnabled: true,\n      TableRowOptions: null,\n      ReviseRecordId: null,\n      SelectedCityList: []\n    };\n    this.onBeforeSubmit = this.onBeforeSubmit.bind(this);\n    this.onSubmitError = this.onSubmitError.bind(this);\n    this.onSubmitSuccess = this.onSubmitSuccess.bind(this);\n    this.AddFormData = this.AddFormData.bind(this);\n    this.DeleteFormData = this.DeleteFormData.bind(this);\n    this.IsFormValid = this.IsFormValid.bind(this);\n    this.AddTableRow = this.AddTableRow.bind(this);\n    this.LoadData = this.LoadData.bind(this);\n    this.HasFileOrImageUpload = this.HasFileOrImageUpload.bind(this);\n    this.ShowHideUploadDownloadPage = this.ShowHideUploadDownloadPage.bind(this);\n    this.SetTableRowOptions = this.SetTableRowOptions.bind(this);\n    this.ReloadData = this.ReloadData.bind(this);\n    this.GetCityName = this.GetCityName.bind(this);\n    this.onAutoCompleteItemSelected = this.onAutoCompleteItemSelected.bind(this);\n    this.DeleteRowFormLists = this.DeleteRowFormLists.bind(this);\n    this.EditFormData = this.EditFormData.bind(this);\n    this.GetFieldValue = this.GetFieldValue.bind(this);\n    this.GetSelectedCityList = this.GetSelectedCityList.bind(this);\n    this.notificationSystem = /*#__PURE__*/React.createRef();\n    this.U_Id = 1;\n    this.RequestFormId = null;\n    this.dropDownItems = [];\n    this.defaultFormData = null;\n    this.SelectedAutoCompleteItems = [];\n    this.ReviseId = null;\n  } // Events.\n\n\n  componentDidMount() {\n    this.LoadData(this.props.formData);\n  } // Functions.\n\n\n  GetFormFields() {\n    var fieldIds = [];\n    var fields = [];\n    this.defaultFormData.fields.forEach(field => {\n      if (fieldIds.filter(rd => rd == field.fieldId).length >= 1) return;\n      fieldIds.push(field.fieldId);\n      fields.push(field);\n    });\n    return fields;\n  }\n\n  GetSelectedCityList() {\n    if (this.defaultFormData == null) return [];\n    var cityList = [];\n    this.defaultFormData.fields.forEach(field => {\n      var city = cityList.filter(cty => cty.value == field.fieldValue);\n      if (city != null && city.length >= 1) return;\n      if (field.typeId === Constants.FieldTypes.CitySelect) cityList.push({\n        label: field.cityName,\n        value: field.fieldValue\n      });\n    });\n    this.setState({\n      [SelectedCityList_Key]: cityList\n    });\n  }\n\n  ParseDateValue(value) {\n    if (isNaN(value)) return value;else return parseInt(value);\n  }\n\n  LoadData(data) {\n    this.defaultFormData = data;\n    if (this.defaultFormData == null) return;\n    this.GetSelectedCityList();\n\n    if (this.defaultFormData.requestFormId != null) {\n      this.RequestFormId = this.defaultFormData.requestFormId;\n      this.ShowHideUploadDownloadPage(null, '_self');\n      return;\n    }\n\n    var initailValues = {};\n    var requestFormIds = [];\n    var formsData = this.state.FormsData;\n    var tableRows = this.state.TableRows;\n    this.defaultFormData.fields.forEach(field => {\n      if (requestFormIds.filter(rd => rd == field.requestFormId).length <= 0) requestFormIds.push(field.requestFormId);\n    });\n    if (this.defaultFormData.isMulti == false && requestFormIds.length == 1) this.RequestFormId = requestFormIds[0];\n    requestFormIds.forEach(requestFormId => {\n      var fields = this.defaultFormData.fields.filter(field => field.requestFormId === requestFormId);\n      var row = [];\n      var uId = this.U_Id++;\n      fields.forEach(field => {\n        if (this.defaultFormData.isMulti == true && field.requestFieldId == null || this.defaultFormData.isMulti == false && field.requestFieldId != null) {\n          var value = field.fieldValue == null || field.fieldValue == \"\" ? field.initValue : field.fieldValue;\n          if (field.typeId === Constants.FieldTypes.DatePicker && value != null && value != \"\") value = this.ParseDateValue(value);\n          initailValues[field.fieldId] = value;\n        }\n\n        if (this.defaultFormData.isMulti === true) {\n          var colunm = new DynamicFormItem(field.fieldId, field.fieldValue, field.initValue, field.typeId, field.requestFieldId, field.requestFormId, field.requestFieldId === null, field.cityName, uId);\n          row.push(colunm);\n        }\n\n        if (field.typeId === Constants.FieldTypes.DropDown) this.AddDropDownItems(new Item(field.fieldId, field.fieldTypeInfo.items));\n      });\n\n      if (this.defaultFormData.isMulti === true && this.HasRecordValue(row) === true) {\n        tableRows = this.AddTableRow(row, false, tableRows, uId);\n        formsData.DynamicFormItems.push(row);\n      }\n    });\n\n    if (this.defaultFormData.isMulti === true) {\n      initailValues[FormsData_Key] = formsData;\n      initailValues[TableRows_Key] = tableRows;\n    }\n\n    initailValues[UpdateKey_Key] = this.state.updateKey + 1;\n    this.setState(initailValues);\n  }\n\n  AddDropDownItems(item) {\n    if (this.dropDownItems.length == 0) {\n      this.dropDownItems.push(item);\n      return;\n    }\n\n    var isExist = false;\n    this.dropDownItems.forEach(drpItem => {\n      if (isExist === true) return;\n      if (item.Id === drpItem.Id) isExist = true;\n    });\n    if (isExist === false) this.dropDownItems.push(item);\n  }\n\n  CreateTableHeaders() {\n    var tableHeaders = [];\n    var createdFieldIds = [];\n    if (this.HasFileOrImageUpload()) tableHeaders.push({\n      title: \"دانلود / آپلود\",\n      name: \"\"\n    });\n    this.GetFormFields().sort((a, b) => a.order - b.order).map(field => {\n      if (field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader || createdFieldIds.filter(fld => fld === field.fieldId).length >= 1) return;\n      createdFieldIds.push(field.fieldId);\n      if (field.typeId === Constants.FieldTypes.DropDown) this.AddDropDownItems(new Item(field.fieldId, field.fieldTypeInfo.items));\n      tableHeaders.push({\n        title: field.name,\n        name: field.fieldId\n      });\n    });\n    return tableHeaders;\n  }\n\n  IsFormValid() {\n    var isValid = true;\n    this.GetFormFields().forEach(field => {\n      if (isValid === false) return;\n\n      if (this.state[field.fieldId + 'IsValid'] === false) {\n        isValid = false;\n        if (this.defaultFormData.isMulti === true) Helpers.DisplayErrorMessage(this.notificationSystem, null, this.state[field.fieldId + 'ValidFeedBack']);\n      }\n    });\n    return isValid;\n  }\n\n  ReloadData() {\n    var formsData = this.state[FormsData_Key];\n    formsData.DynamicFormItems = [];\n    this.dropDownItems = [];\n    this.RequestFormId = null;\n    var stateValues = {};\n    stateValues[FormsData_Key] = formsData;\n    stateValues[TableRows_Key] = null;\n    this.setState(stateValues);\n    Helpers.CallServer('/api/FRQST/Form/GetFormFields/', {\n      requestId: this.props.requestId,\n      formId: this.props.formId\n    }, successfulResponse => {\n      this.LoadData(successfulResponse.data);\n    }, errorResponse => {\n      return HandleError(Helpers, this.notificationSystem, errorResponse);\n    }, () => {\n      // Do tasks if it is neccessary\n      console.log('Done');\n    });\n  } // Events.\n\n\n  onBeforeSubmit() {\n    this.AddFormData(true, null, null);\n    return true;\n  }\n\n  onSubmitError(er) {\n    return HandleError(Helpers, this.notificationSystem, er);\n  }\n\n  onSubmitSuccess(response) {\n    var formsData = this.state.FormsData;\n    formsData.DynamicFormItems = [];\n    this.setState({\n      updateKey: this.state.updateKey + 1,\n      SaveButtonEnabled: false\n    });\n    Helpers.DisplaySuccessMessage(this.notificationSystem, 'اطلاعات با موفقیت ذخیره شد');\n    this.ReloadData();\n    if (response.data != null && response.data.data != null && response.data.data.length >= 1) for (var index = 0; index < response.data.data.length; index++) Helpers.DisplayWarningMessage(this.notificationSystem, null, response.data.data[index]);\n    return true;\n  }\n\n  GetRowId(row) {\n    var id = -1;\n    row.forEach(column => {\n      if (id !== -1) return;\n      if (column.name === UID_Name) id = column.value;\n    });\n    return id;\n  }\n\n  IsRowIdExist(row, tableRow) {\n    var found = true;\n    row.forEach(column => {\n      if (found == false) return;\n      if (tableRow.filter(cls => cls.name == column.FieldId).length <= 0) found = false;\n    });\n    return found;\n  }\n\n  GetRequestFormId(row) {\n    var foundRequestFormId = -1;\n    row.forEach(column => {\n      if (foundRequestFormId !== -1) return;\n      if (column.name !== UID_Name && column.ExtraData !== null) foundRequestFormId = column.ExtraData.RequestFormId;\n    });\n    return foundRequestFormId;\n  }\n\n  DeleteRowFormLists(row) {\n    var tableRows = this.state.TableRows;\n    var formsData = this.state.FormsData;\n    var id = this.GetRowId(row);\n    var count = 0;\n    count = tableRows.length;\n    tableRows = tableRows.filter(rw => this.GetRowId(rw) != id);\n\n    if (count - tableRows.length > 1) {\n      Helpers.DisplayErrorMessage(this.notificationSystem, null, 'بیش از یک رکورد از جدول پیدا شد');\n      return null;\n    } else if (count - tableRows.length <= 0) {\n      Helpers.DisplayErrorMessage(this.notificationSystem, null, 'رکورد مورد نظر از جدول پیدا نشد');\n      return null;\n    }\n\n    count = formsData.DynamicFormItems.length;\n    formsData.DynamicFormItems = formsData.DynamicFormItems.filter(fd => fd[0].UniqueId != id);\n\n    if (count - formsData.DynamicFormItems.length > 1) {\n      Helpers.DisplayErrorMessage(this.notificationSystem, null, 'بیش از یک رکورد پیدا شد');\n      return null;\n    } else if (count - formsData.DynamicFormItems.length <= 0) {\n      Helpers.DisplayErrorMessage(this.notificationSystem, null, 'رکورد مورد نظر پیدا نشد');\n      return null;\n    }\n\n    return {\n      TableRows: tableRows,\n      FormsData: formsData\n    };\n  }\n\n  DeleteFormData(option) {\n    var row = option.modalData;\n    var requestFormId = this.GetRequestFormId(row);\n    var result = this.DeleteRowFormLists(row);\n    if (result == null) return;\n\n    if (requestFormId != null) {\n      Helpers.CallServer('/api/FRQST/Form/DeleteFormData', {\n        Id: requestFormId\n      }, successfulResponse => {\n        option.modalOpen = false;\n        this.setState({\n          TableRows: result.TableRows,\n          FormsData: result.FormsData,\n          updateKey: this.state.updateKey + 1\n        });\n      }, errorResponse => {\n        return HandleError(Helpers, this.notificationSystem, errorResponse);\n      }, () => {\n        console.log('Done');\n      });\n    } else this.setState({\n      TableRows: result.TableRows,\n      FormsData: result.FormsData,\n      updateKey: this.state.updateKey + 1\n    });\n  }\n\n  GetDropDownItem(id, value) {\n    var itemValue = null;\n    this.dropDownItems.forEach(drItem => {\n      if (itemValue !== null || drItem.Id !== id) return;\n      drItem.Value.forEach(option => {\n        if (option.value === value) itemValue = option.label;\n      });\n    });\n    return itemValue;\n  }\n\n  HasRecordValue(row) {\n    var hasValue = false;\n    row.forEach(column => {\n      if (column.FieldTypeId == Constants.FieldTypes.FileUploader || column.FieldTypeId == Constants.FieldTypes.ImageUploader) return;\n      if (hasValue == true) return;\n      if (column.FieldValue != null) hasValue = true;\n    });\n    return hasValue;\n  }\n\n  GetFieldValue(dynamicDataItem) {\n    var value;\n\n    switch (dynamicDataItem.FieldTypeId) {\n      case Constants.FieldTypes.DatePicker:\n        if (dynamicDataItem.FieldValue == null || dynamicDataItem.FieldValue == '') value = \"\";else if (isNaN(dynamicDataItem.FieldValue)) value = Helpers.ToPersianJustDate(dynamicDataItem.FieldValue);else value = Helpers.ToPersianJustDate(ConvertEpochToGregorianDate(dynamicDataItem.FieldValue));\n        break;\n\n      case Constants.FieldTypes.DropDown:\n        if (dynamicDataItem.FieldValue == null || dynamicDataItem.FieldValue == '') value = '';else {\n          var optionValue = this.GetDropDownItem(dynamicDataItem.FieldId, dynamicDataItem.FieldValue);\n          value = optionValue == null ? '???' : optionValue;\n        }\n        break;\n\n      case Constants.FieldTypes.CitySelect:\n        value = dynamicDataItem.CityName;\n        break;\n\n      default:\n        value = dynamicDataItem.FieldValue;\n        break;\n    }\n\n    return value;\n  }\n\n  AddTableRow(row, isNew, tableRowsData, uniqueId) {\n    var tableRows = tableRowsData === null ? this.state.TableRows : tableRowsData;\n    if (this.HasRecordValue(row) == false) return tableRows;\n    var columns = [];\n    if (tableRows == null) tableRows = [];\n    columns.push(new TableItem(UID_Name, uniqueId, new RecordState(isNew, null, null)));\n    row.forEach(column => {\n      if (column.FieldTypeId == Constants.FieldTypes.FileUploader || column.FieldTypeId == Constants.FieldTypes.ImageUploader) return;\n      var value = this.GetFieldValue(column);\n      columns.push(new TableItem(column.FieldId, value, {\n        RequestFormId: column.RequestFormId\n      }));\n    });\n    tableRows.push(columns);\n    return tableRows;\n  }\n\n  AddFormData(ignore_Validation, vFormData, vTableRows) {\n    if (this.defaultFormData.isMulti === true && ignore_Validation === true) return;\n    if (ignore_Validation === false && this.IsFormValid() === false) return;\n    var formsData = vFormData == null ? this.state.FormsData : vFormData;\n    var stateData = {};\n    var fields = this.GetFormFields();\n    var id = this.state[ReviseRecordId_Key];\n\n    if (id != null) {\n      var tableRows = vTableRows === null ? this.state.TableRows : vTableRows;\n      var tableRow = tableRows.filter(rw => this.GetRowId(rw) == id);\n      var formData = formsData.DynamicFormItems.filter(fd => fd[0].UniqueId == id);\n\n      if (formData == null || formData.length <= 0) {\n        Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات فرم جهت ویرایش پیدا نشد');\n        return;\n      }\n\n      if (tableRow == null || tableRow.length <= 0) {\n        Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات جدول جهت ویرایش پیدا نشد');\n        return;\n      }\n\n      fields.forEach(field => {\n        if (field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader) return;\n        var srd = formData[0].filter(rd => rd.FieldId == field.fieldId);\n        var crd = tableRow[0].filter(rd => rd.name == field.fieldId);\n\n        if (srd == null || srd.length <= 0) {\n          Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات فیلد جهت ویرایش پیدا نشد');\n          return;\n        }\n\n        if (crd == null || crd.length <= 0) {\n          Helpers.DisplayWarningMessage(this.notificationSystem, null, 'فیلد جدول جهت ویرایش پیدا نشد');\n          return;\n        }\n\n        var fieldValue = null;\n        if (field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader) fieldValue = \"\";else fieldValue = this.state[field.fieldId];\n        srd[0].FieldValue = fieldValue;\n        srd[0].CityName = this.GetCityName(field.fieldId, field.cityName);\n        crd[0].value = this.GetFieldValue(srd[0]);\n      });\n      formsData.DynamicFormItems = formsData.DynamicFormItems.filter(fd => fd[0].UniqueId != id);\n      formsData.DynamicFormItems.push(formData[0]);\n      tableRows = tableRows.filter(rw => this.GetRowId(rw) != id);\n      tableRows.push(tableRow[0]);\n      stateData[ReviseRecordId_Key] = null;\n      stateData[UpdateKey_Key] = this.state.updateKey + 1;\n      stateData[FormsData_Key] = formsData;\n      stateData[TableRows_Key] = tableRows;\n      fields.forEach(field => stateData[field.fieldId] = null);\n      this.setState(stateData);\n      return;\n    }\n\n    var row = [];\n    var uId = this.U_Id++;\n    fields.forEach(field => {\n      var fieldValue = null;\n      if (field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader) fieldValue = \"\";else fieldValue = this.state[field.fieldId];\n      row.push(new DynamicFormItem(field.fieldId, fieldValue, \"\", field.typeId, this.defaultFormData.isMulti === true ? null : field.requestFieldId, this.defaultFormData.isMulti === true ? null : field.requestFormId, this.defaultFormData.isMulti === true ? true : field.requestFieldId === null, this.GetCityName(field.fieldId, field.cityName), uId));\n    });\n    formsData.DynamicFormItems.push(row);\n\n    if (this.defaultFormData.isMulti === false) {\n      this.setState({\n        [FormsData_Key]: formsData\n      });\n      return;\n    }\n\n    fields.forEach(field => stateData[field.fieldId] = null);\n    stateData[FormsData_Key] = formsData;\n    stateData[TableRows_Key] = this.AddTableRow(row, true, vTableRows, uId);\n    stateData[UpdateKey_Key] = this.state.updateKey + 1;\n    this.setState(stateData);\n  }\n\n  HasFileOrImageUpload() {\n    return this.GetFormFields().filter(fld => fld.typeId === Constants.FieldTypes.FileUploader || fld.typeId == Constants.FieldTypes.ImageUploader).length >= 1;\n  }\n\n  ShowHideUploadDownloadPage(row, target) {\n    var requestFormId = null;\n\n    if (this.RequestFormId == null) {\n      if (row.length != null) row.forEach(col => {\n        if (requestFormId != null) return;\n        if (col.ExtraData != null && col.ExtraData.RequestFormId != null) requestFormId = col.ExtraData.RequestFormId;\n      });\n    } else requestFormId = this.RequestFormId;\n\n    if (requestFormId == null) {\n      Helpers.DisplayWarningMessage(this.notificationSystem, null, 'ابتدا اطلاعات فرم را ذخیره نمایید و سپس فرم \"دانلود / آپلود\" را باز نمایید');\n      return;\n    }\n\n    var finalTarget = target == null ? \"_blank\" : target;\n    window.open(GetUrl(\"dynamicUploadDownloadPage/\" + this.props.requestId + \"/\" + requestFormId), finalTarget);\n  }\n\n  SetTableRowOptions() {\n    var rowOptions = [];\n    rowOptions.push({\n      title: 'ویرایش',\n      icon: 'edit',\n      func: this.EditFormData\n    });\n    if (this.HasFileOrImageUpload()) rowOptions.push({\n      title: 'دانلود / آپلود',\n      icon: 'download',\n      func: this.ShowHideUploadDownloadPage\n    });\n    return rowOptions;\n  }\n\n  GetCityName(filedId, cityName) {\n    var record = this.SelectedAutoCompleteItems.filter(rd => rd.FieldId == filedId);\n    if (record.length == 1) return record[0].Item.label;\n    if (cityName != null || cityName != '') return cityName;\n    return '???';\n  }\n\n  onAutoCompleteItemSelected(fieldId, item) {\n    this.SelectedAutoCompleteItems = this.SelectedAutoCompleteItems.filter(rd => rd.FieldId != fieldId);\n    this.SelectedAutoCompleteItems.push({\n      FieldId: fieldId,\n      Item: item\n    });\n    var selectedCityList = this.state[SelectedCityList_Key];\n    var city = selectedCityList.filter(cty => cty.value == item.value);\n    if (city != null && city.length >= 1) return;\n    selectedCityList.push(item);\n    this.setState({\n      [SelectedCityList_Key]: selectedCityList\n    });\n  }\n\n  EditFormData(row) {\n    if (row == null || row.length <= 0) {\n      Helpers.DisplayWarningMessage(this.notificationSystem, null, \"اطلاعات فرم پیدا نشد\");\n      return;\n    }\n\n    var id = this.GetRowId(row);\n    this.ReviseId = id;\n    var formData = this.state.FormsData.DynamicFormItems.filter(fd => fd[0].UniqueId == id);\n    var state = {};\n\n    if (formData == null || formData.length <= 0) {\n      Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات فرم پیدا نشد');\n      return;\n    }\n\n    this.GetFormFields().forEach(field => {\n      var fieldData = formData[0].filter(fld => fld.FieldId == field.fieldId);\n\n      if (fieldData == null || fieldData.length <= 0) {\n        Helpers.DisplayWarningMessage(this.notificationSystem, null, 'مقدار فیلد در حالت ویرایش پیدا نشد');\n        return;\n      }\n\n      if (field.typeId === Constants.FieldTypes.DatePicker && fieldData[0].FieldValue != null && fieldData[0].FieldValue != \"\") state[field.fieldId] = this.ParseDateValue(fieldData[0].FieldValue);else state[field.fieldId] = fieldData[0].FieldValue;\n    });\n    state[UpdateKey_Key] = this.state.updateKey + 1;\n    state[ReviseRecordId_Key] = id;\n    this.setState(state);\n  }\n\n  render() {\n    if (this.defaultFormData == null) return;\n    var controls = [];\n    this.GetFormFields().sort((a, b) => a.order - b.order).forEach(ctl => {\n      if (ctl.typeId === Constants.FieldTypes.FileUploader || ctl.typeId == Constants.FieldTypes.ImageUploader) return;\n      controls.push( /*#__PURE__*/_jsxDEV(DynamicControlSection, {\n        parentContext: this,\n        context: this,\n        parentNotificationSystem: this.notificationSystem,\n        onAutoCompleteItemSelected: this.onAutoCompleteItemSelected,\n        offLineAutoCompleteList: this.state.SelectedCityList,\n        data: ctl\n      }, ctl.fieldId, false, {\n        fileName: _jsxFileName,\n        lineNumber: 739,\n        columnNumber: 27\n      }, this));\n    });\n\n    if (this.defaultFormData.isMulti) {\n      controls.push( /*#__PURE__*/_jsxDEV(Delimiter, {}, 'dl001', false, {\n        fileName: _jsxFileName,\n        lineNumber: 750,\n        columnNumber: 27\n      }, this));\n      controls.push( /*#__PURE__*/_jsxDEV(CellContainer, {\n        lgCol: 12,\n        borderRightColor: \"info\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col p-2\",\n            children: /*#__PURE__*/_jsxDEV(\"a\", {\n              className: \"btn btn-sm btn-outline-primary float-end\",\n              onClick: () => this.AddFormData(false, null, null),\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"ti me-2 ti-circle-plus\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 755,\n                columnNumber: 45\n              }, this), this.state[ReviseRecordId_Key] == null ? \"افزودن\" : \"ویرایش\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 754,\n              columnNumber: 41\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 753,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 752,\n          columnNumber: 33\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col align-self-center\",\n            children: /*#__PURE__*/_jsxDEV(Table, {\n              hasDeleteButton: true,\n              headers: this.CreateTableHeaders(),\n              data: this.state.TableRows,\n              lgCol: 12,\n              rowOptions: this.SetTableRowOptions(),\n              minHeightTableWrapper: 200,\n              onDeleteButton: this.DeleteFormData\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 761,\n              columnNumber: 41\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 760,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 759,\n          columnNumber: 33\n        }, this)]\n      }, 'cc001', true, {\n        fileName: _jsxFileName,\n        lineNumber: 751,\n        columnNumber: 27\n      }, this));\n    } else {\n      if (this.HasFileOrImageUpload()) controls.push( /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-12 col-mg-12\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn btn-light position-relative float-end\",\n            style: {\n              \"width\": \"120px\"\n            },\n            onClick: this.ShowHideUploadDownloadPage,\n            children: \"\\u062F\\u0627\\u0646\\u0644\\u0648\\u062F / \\u0622\\u067E\\u0644\\u0648\\u062F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 778,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 777,\n          columnNumber: 29\n        }, this)\n      }, \"divUD\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 776,\n        columnNumber: 25\n      }, this));\n    }\n\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Card, {\n        context: this,\n        title: this.props.title,\n        submitUrl: \"/api/FRQST/Form/SaveDynamicFormData\",\n        hasBackButton: true,\n        hasDefaultSaveButton: this.state.SaveButtonEnabled,\n        statusColor: \"success\",\n        updateKey: this.state.updateKey,\n        onSubmitError: this.onSubmitError,\n        onBeforeSubmit: this.onBeforeSubmit,\n        onSubmitSuccess: this.onSubmitSuccess // ToDo: Complete the old form pages\n        //topButtons={[{ title: \"استفاده از اطلاعات فرم های قدیمی\", icon: \"forms\", color: \"outline-success\", url: GetUrl(\"approvedFormData\") } ]}\n        ,\n        ignoreValidation: this.defaultFormData.isMulti ? true : false,\n        children: controls\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 787,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(NotificationSystem, {\n        ref: this.notificationSystem\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 802,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  }\n\n}","map":{"version":3,"names":["React","DynamicControlSection","Card","Delimiter","Helpers","CellContainer","Table","NotificationSystem","Item","Constants","TableItem","RecordState","DynamicFormItem","DynamicFormData","GetUrl","HandleError","ConvertEpochToGregorianDate","UID_Name","FormsData_Key","TableRows_Key","UpdateKey_Key","ReviseRecordId_Key","SelectedCityList_Key","DynamicFormSection","Component","constructor","props","state","updateKey","FormsData","requestId","formId","SaveButtonEnabled","TableRowOptions","ReviseRecordId","SelectedCityList","onBeforeSubmit","bind","onSubmitError","onSubmitSuccess","AddFormData","DeleteFormData","IsFormValid","AddTableRow","LoadData","HasFileOrImageUpload","ShowHideUploadDownloadPage","SetTableRowOptions","ReloadData","GetCityName","onAutoCompleteItemSelected","DeleteRowFormLists","EditFormData","GetFieldValue","GetSelectedCityList","notificationSystem","createRef","U_Id","RequestFormId","dropDownItems","defaultFormData","SelectedAutoCompleteItems","ReviseId","componentDidMount","formData","GetFormFields","fieldIds","fields","forEach","field","filter","rd","fieldId","length","push","cityList","city","cty","value","fieldValue","typeId","FieldTypes","CitySelect","label","cityName","setState","ParseDateValue","isNaN","parseInt","data","requestFormId","initailValues","requestFormIds","formsData","tableRows","TableRows","isMulti","row","uId","requestFieldId","initValue","DatePicker","colunm","DropDown","AddDropDownItems","fieldTypeInfo","items","HasRecordValue","DynamicFormItems","item","isExist","drpItem","Id","CreateTableHeaders","tableHeaders","createdFieldIds","title","name","sort","a","b","order","map","FileUploader","ImageUploader","fld","isValid","DisplayErrorMessage","stateValues","CallServer","successfulResponse","errorResponse","console","log","er","response","DisplaySuccessMessage","index","DisplayWarningMessage","GetRowId","id","column","IsRowIdExist","tableRow","found","cls","FieldId","GetRequestFormId","foundRequestFormId","ExtraData","count","rw","fd","UniqueId","option","modalData","result","modalOpen","GetDropDownItem","itemValue","drItem","Value","hasValue","FieldTypeId","FieldValue","dynamicDataItem","ToPersianJustDate","optionValue","CityName","isNew","tableRowsData","uniqueId","columns","ignore_Validation","vFormData","vTableRows","stateData","srd","crd","target","col","finalTarget","window","open","rowOptions","icon","func","filedId","record","selectedCityList","fieldData","render","controls","ctl"],"sources":["D:/Projects/React/AMLS/src/sections/dynamicForm/dynamicFormSection.js"],"sourcesContent":["import React from \"react\";\r\nimport DynamicControlSection from '../dynamicForm/dynamicControlSection';\r\nimport { Card, Delimiter, Helpers, CellContainer, Table } from \"core\";\r\nimport NotificationSystem from 'react-notification-system'\r\nimport Item from '../../models/item'\r\nimport Constants from '../../utils/constants'\r\nimport TableItem from '../../models/tableItem'\r\nimport RecordState from '../../models/recordState'\r\nimport DynamicFormItem from '../../models/dynamicFormItem'\r\nimport DynamicFormData from '../../models/dynamicFormData'\r\nimport { GetUrl, HandleError, ConvertEpochToGregorianDate } from '../../utils/generals'\r\n\r\nconst UID_Name = 'Record_Unique_Id';\r\nconst FormsData_Key = 'FormsData';\r\nconst TableRows_Key = 'TableRows';\r\nconst UpdateKey_Key = 'updateKey';\r\nconst ReviseRecordId_Key = \"ReviseRecordId\";\r\nconst SelectedCityList_Key = \"SelectedCityList\";\r\n\r\nexport default class DynamicFormSection extends React.Component\r\n{\r\n    // Constructor\r\n    constructor(props)\r\n    {\r\n        super(props);\r\n        this.state = {\r\n            updateKey: 1,\r\n            FormsData: new DynamicFormData(this.props.requestId, this.props.formId, []),\r\n            SaveButtonEnabled: true,\r\n            TableRowOptions: null,\r\n            ReviseRecordId: null,\r\n            SelectedCityList: []\r\n        };\r\n        this.onBeforeSubmit = this.onBeforeSubmit.bind(this);\r\n        this.onSubmitError = this.onSubmitError.bind(this);\r\n        this.onSubmitSuccess = this.onSubmitSuccess.bind(this);\r\n        this.AddFormData = this.AddFormData.bind(this);\r\n        this.DeleteFormData = this.DeleteFormData.bind(this);\r\n        this.IsFormValid = this.IsFormValid.bind(this);\r\n        this.AddTableRow = this.AddTableRow.bind(this);\r\n        this.LoadData = this.LoadData.bind(this);\r\n        this.HasFileOrImageUpload = this.HasFileOrImageUpload.bind(this);\r\n        this.ShowHideUploadDownloadPage = this.ShowHideUploadDownloadPage.bind(this);\r\n        this.SetTableRowOptions = this.SetTableRowOptions.bind(this);\r\n        this.ReloadData = this.ReloadData.bind(this);\r\n        this.GetCityName = this.GetCityName.bind(this);\r\n        this.onAutoCompleteItemSelected = this.onAutoCompleteItemSelected.bind(this);\r\n        this.DeleteRowFormLists = this.DeleteRowFormLists.bind(this);\r\n        this.EditFormData = this.EditFormData.bind(this);\r\n        this.GetFieldValue = this.GetFieldValue.bind(this);\r\n        this.GetSelectedCityList = this.GetSelectedCityList.bind(this);\r\n\r\n        this.notificationSystem = React.createRef();\r\n        this.U_Id = 1;\r\n        this.RequestFormId = null;\r\n        this.dropDownItems = [];\r\n        this.defaultFormData = null;\r\n        this.SelectedAutoCompleteItems = [];\r\n        this.ReviseId = null;\r\n    }\r\n\r\n    // Events.\r\n    componentDidMount()\r\n    {\r\n        this.LoadData(this.props.formData);\r\n    }\r\n\r\n    // Functions.\r\n    GetFormFields()\r\n    {\r\n        var fieldIds = [];\r\n        var fields = [];\r\n\r\n        this.defaultFormData.fields.forEach((field) =>\r\n        {\r\n            if(fieldIds.filter(rd => rd == field.fieldId).length >= 1)\r\n                return;\r\n            fieldIds.push(field.fieldId);\r\n            fields.push(field);\r\n        });\r\n        return fields;\r\n    }\r\n\r\n    GetSelectedCityList()\r\n    {\r\n        if(this.defaultFormData == null)\r\n            return [];\r\n        var cityList = [];\r\n\r\n        this.defaultFormData.fields.forEach((field) =>\r\n        {\r\n            var city = cityList.filter(cty => cty.value == field.fieldValue);\r\n\r\n            if(city != null && city.length >= 1)\r\n                return;\r\n            if(field.typeId === Constants.FieldTypes.CitySelect)\r\n                cityList.push({ label: field.cityName, value: field.fieldValue });\r\n        });\r\n        this.setState({ [SelectedCityList_Key]: cityList });\r\n    }\r\n\r\n    ParseDateValue(value)\r\n    {\r\n        if(isNaN(value))\r\n            return value;\r\n        else\r\n            return parseInt(value);\r\n    }\r\n\r\n    LoadData(data)\r\n    {\r\n        this.defaultFormData = data;\r\n\r\n        if(this.defaultFormData == null)\r\n            return;\r\n        this.GetSelectedCityList();\r\n        if(this.defaultFormData.requestFormId != null)\r\n        {\r\n            this.RequestFormId = this.defaultFormData.requestFormId;\r\n            this.ShowHideUploadDownloadPage(null, '_self');\r\n            return;\r\n        }\r\n        var initailValues = {};\r\n        var requestFormIds = [];\r\n        var formsData = this.state.FormsData;\r\n        var tableRows = this.state.TableRows;\r\n\r\n        this.defaultFormData.fields.forEach((field) =>\r\n        {\r\n            if(requestFormIds.filter(rd => rd == field.requestFormId).length <= 0)\r\n                requestFormIds.push(field.requestFormId);\r\n        });\r\n        if(this.defaultFormData.isMulti == false && requestFormIds.length == 1)\r\n            this.RequestFormId = requestFormIds[0];\r\n        requestFormIds.forEach(requestFormId =>\r\n        {\r\n            var fields = this.defaultFormData.fields.filter(field => field.requestFormId === requestFormId);\r\n            var row = [];\r\n            var uId = this.U_Id++;\r\n\r\n            fields.forEach(field =>\r\n                {\r\n                    if((this.defaultFormData.isMulti == true && field.requestFieldId == null) || (this.defaultFormData.isMulti == false && field.requestFieldId != null))\r\n                    {\r\n                        var value = (field.fieldValue == null || field.fieldValue == \"\" ? field.initValue : field.fieldValue);\r\n\r\n                        if(field.typeId === Constants.FieldTypes.DatePicker && value != null && value != \"\")\r\n                            value = this.ParseDateValue(value);\r\n                        initailValues[field.fieldId] = value;\r\n                    }\r\n                    if(this.defaultFormData.isMulti === true)\r\n                    {\r\n                        var colunm = new DynamicFormItem(field.fieldId,\r\n                                                         field.fieldValue,\r\n                                                         field.initValue,\r\n                                                         field.typeId,\r\n                                                         field.requestFieldId,\r\n                                                         field.requestFormId,\r\n                                                         field.requestFieldId === null,\r\n                                                         field.cityName,\r\n                                                         uId);\r\n                        \r\n                        row.push(colunm);\r\n                    }\r\n                    if(field.typeId === Constants.FieldTypes.DropDown)\r\n                        this.AddDropDownItems(new Item(field.fieldId, field.fieldTypeInfo.items));\r\n                });\r\n            if(this.defaultFormData.isMulti === true && this.HasRecordValue(row) === true)\r\n            {\r\n                tableRows = this.AddTableRow(row, false, tableRows, uId);\r\n                formsData.DynamicFormItems.push(row);\r\n            }\r\n        });\r\n        if(this.defaultFormData.isMulti === true)\r\n        {\r\n            initailValues[FormsData_Key] = formsData;\r\n            initailValues[TableRows_Key] = tableRows;\r\n        }\r\n        initailValues[UpdateKey_Key] = this.state.updateKey + 1;\r\n        this.setState(initailValues);\r\n    }\r\n    \r\n    AddDropDownItems(item)\r\n    {\r\n        if(this.dropDownItems.length == 0)\r\n        {\r\n            this.dropDownItems.push(item);\r\n            return;\r\n        }\r\n        var isExist = false;\r\n\r\n        this.dropDownItems.forEach(drpItem =>\r\n            {\r\n                if(isExist === true)\r\n                    return;\r\n                if(item.Id === drpItem.Id)\r\n                    isExist = true;\r\n            })\r\n        if(isExist === false)\r\n            this.dropDownItems.push(item);\r\n    }\r\n\r\n    CreateTableHeaders()\r\n    {\r\n        var tableHeaders = [];\r\n        var createdFieldIds = [];\r\n\r\n        if(this.HasFileOrImageUpload())\r\n            tableHeaders.push({\r\n                title: \"دانلود / آپلود\",\r\n                name: \"\"\r\n            });        \r\n        this.GetFormFields().sort((a, b) => a.order - b.order).map((field) =>\r\n           {\r\n               if(field.typeId === Constants.FieldTypes.FileUploader ||\r\n                  field.typeId == Constants.FieldTypes.ImageUploader ||\r\n                  createdFieldIds.filter(fld => fld === field.fieldId).length >= 1)\r\n                   return;\r\n               createdFieldIds.push(field.fieldId);\r\n                if(field.typeId === Constants.FieldTypes.DropDown)\r\n                    this.AddDropDownItems(new Item(field.fieldId, field.fieldTypeInfo.items));\r\n               tableHeaders.push({\r\n                   title: field.name,\r\n                   name: field.fieldId\r\n               });\r\n           });\r\n        return tableHeaders;\r\n    }\r\n\r\n    IsFormValid()\r\n    {\r\n        var isValid = true;\r\n\r\n        this.GetFormFields().forEach(field =>\r\n        {\r\n            if(isValid === false)\r\n                return;\r\n            if(this.state[field.fieldId + 'IsValid'] === false)\r\n            {\r\n                isValid = false;\r\n                if(this.defaultFormData.isMulti === true)\r\n                    Helpers.DisplayErrorMessage(this.notificationSystem, null, this.state[field.fieldId + 'ValidFeedBack']);\r\n            }\r\n        });\r\n        return isValid;\r\n    }\r\n\r\n    ReloadData()\r\n    {\r\n        var formsData = this.state[FormsData_Key];\r\n\r\n        formsData.DynamicFormItems = [];\r\n        this.dropDownItems = [];\r\n        this.RequestFormId = null;\r\n\r\n        var stateValues = { };\r\n\r\n        stateValues[FormsData_Key] = formsData;\r\n        stateValues[TableRows_Key] = null;\r\n        this.setState(stateValues);\r\n        Helpers.CallServer('/api/FRQST/Form/GetFormFields/',\r\n                            {\r\n                                requestId: this.props.requestId,\r\n                                formId: this.props.formId\r\n                            },\r\n                            successfulResponse =>\r\n                            {\r\n                                this.LoadData(successfulResponse.data);\r\n                            },\r\n                            errorResponse => {\r\n                                return HandleError(Helpers, this.notificationSystem, errorResponse);\r\n                            },\r\n                            () =>\r\n                            {\r\n                                // Do tasks if it is neccessary\r\n                                console.log('Done');\r\n                            })\r\n    }\r\n\r\n    // Events.\r\n    onBeforeSubmit() {\r\n        this.AddFormData(true, null, null);\r\n        return true;\r\n    }\r\n\r\n    onSubmitError(er) {\r\n        return HandleError(Helpers, this.notificationSystem, er);\r\n    }\r\n\r\n    onSubmitSuccess(response)\r\n    {\r\n        var formsData = this.state.FormsData;\r\n\r\n        formsData.DynamicFormItems = [];\r\n        this.setState({\r\n            updateKey: this.state.updateKey + 1,\r\n            SaveButtonEnabled: false\r\n        });\r\n        Helpers.DisplaySuccessMessage(this.notificationSystem, 'اطلاعات با موفقیت ذخیره شد');\r\n        \r\n        this.ReloadData();\r\n        if(response.data != null && response.data.data != null && response.data.data.length >= 1)\r\n            for(var index = 0; index < response.data.data.length; index++)\r\n                Helpers.DisplayWarningMessage(this.notificationSystem, null, response.data.data[index]);\r\n        return true;\r\n    }\r\n\r\n    GetRowId(row)\r\n    {\r\n        var id = -1;\r\n\r\n        row.forEach(column =>\r\n            {\r\n                if(id !== -1)\r\n                    return;\r\n                if(column.name === UID_Name)\r\n                    id = column.value;\r\n            });\r\n        return id;\r\n    }\r\n\r\n    IsRowIdExist(row, tableRow)\r\n    {\r\n        var found = true;\r\n\r\n        row.forEach(column =>\r\n        {\r\n            if(found == false)\r\n                return;\r\n            if(tableRow.filter(cls => cls.name == column.FieldId).length <= 0)\r\n                found = false;\r\n        });\r\n        return found;\r\n    }\r\n\r\n    GetRequestFormId(row)\r\n    {\r\n        var foundRequestFormId = -1;\r\n\r\n        row.forEach(column =>\r\n            {\r\n                if(foundRequestFormId !== -1)\r\n                    return;\r\n                if(column.name !== UID_Name && column.ExtraData !== null)\r\n                    foundRequestFormId = column.ExtraData.RequestFormId;\r\n            });\r\n        return foundRequestFormId;\r\n    }\r\n\r\n    DeleteRowFormLists(row)\r\n    {\r\n        var tableRows = this.state.TableRows;\r\n        var formsData = this.state.FormsData;\r\n        var id = this.GetRowId(row);\r\n        var count = 0;\r\n\r\n        count = tableRows.length;\r\n        tableRows = tableRows.filter(rw => this.GetRowId(rw) != id);\r\n        if((count - tableRows.length) > 1)\r\n        {\r\n            Helpers.DisplayErrorMessage(this.notificationSystem, null, 'بیش از یک رکورد از جدول پیدا شد');\r\n            return null;\r\n        }\r\n        else if((count - tableRows.length) <= 0)\r\n        {\r\n            Helpers.DisplayErrorMessage(this.notificationSystem, null, 'رکورد مورد نظر از جدول پیدا نشد');\r\n            return null;\r\n        }\r\n        count = formsData.DynamicFormItems.length;\r\n        formsData.DynamicFormItems = formsData.DynamicFormItems.filter(fd => fd[0].UniqueId != id);\r\n        if((count - formsData.DynamicFormItems.length) > 1)\r\n        {\r\n            Helpers.DisplayErrorMessage(this.notificationSystem, null, 'بیش از یک رکورد پیدا شد');\r\n            return null;\r\n        }\r\n        else if((count - formsData.DynamicFormItems.length) <= 0)\r\n        {\r\n            Helpers.DisplayErrorMessage(this.notificationSystem, null, 'رکورد مورد نظر پیدا نشد');\r\n            return null;\r\n        }\r\n        return {\r\n            TableRows: tableRows,\r\n            FormsData: formsData\r\n        };\r\n    }\r\n\r\n    DeleteFormData(option)\r\n    {\r\n        var row = option.modalData;\r\n        var requestFormId = this.GetRequestFormId(row);\r\n        var result = this.DeleteRowFormLists(row);\r\n\r\n        if(result == null)\r\n            return;\r\n        if(requestFormId != null)\r\n        {\r\n            Helpers.CallServer('/api/FRQST/Form/DeleteFormData',\r\n            { Id: requestFormId },\r\n            successfulResponse =>\r\n            {\r\n                option.modalOpen = false;\r\n                this.setState({\r\n                    TableRows: result.TableRows,\r\n                    FormsData: result.FormsData,\r\n                    updateKey: this.state.updateKey + 1\r\n                });\r\n            },\r\n            errorResponse => {\r\n                return HandleError(Helpers, this.notificationSystem, errorResponse);\r\n            },\r\n            () =>\r\n            {\r\n                console.log('Done');\r\n            })\r\n        }\r\n        else\r\n            this.setState({\r\n                TableRows: result.TableRows,\r\n                FormsData: result.FormsData,\r\n                updateKey: this.state.updateKey + 1\r\n            });\r\n    }\r\n\r\n    GetDropDownItem(id, value)\r\n    {\r\n        var itemValue = null;\r\n        \r\n        this.dropDownItems.forEach(drItem =>\r\n        {\r\n            if(itemValue !== null || drItem.Id !== id)\r\n                return;\r\n            drItem.Value.forEach(option =>\r\n                {\r\n                    if(option.value === value)\r\n                        itemValue = option.label;\r\n                });\r\n        });\r\n        return itemValue;\r\n    }\r\n\r\n    HasRecordValue(row)\r\n    {\r\n        var hasValue = false;\r\n\r\n        row.forEach(column =>\r\n            {\r\n                if(column.FieldTypeId == Constants.FieldTypes.FileUploader || column.FieldTypeId == Constants.FieldTypes.ImageUploader)\r\n                    return;\r\n                if(hasValue == true)\r\n                    return;\r\n                if(column.FieldValue != null)\r\n                    hasValue = true;\r\n            });\r\n        return hasValue;\r\n    }\r\n\r\n    GetFieldValue(dynamicDataItem)\r\n    {\r\n        var value; \r\n\r\n        switch(dynamicDataItem.FieldTypeId)\r\n        {\r\n            case Constants.FieldTypes.DatePicker:\r\n                if(dynamicDataItem.FieldValue == null || dynamicDataItem.FieldValue == '')\r\n                    value = \"\";\r\n                else if(isNaN(dynamicDataItem.FieldValue))\r\n                    value = Helpers.ToPersianJustDate(dynamicDataItem.FieldValue);\r\n                else\r\n                    value = Helpers.ToPersianJustDate(ConvertEpochToGregorianDate(dynamicDataItem.FieldValue));\r\n            break;\r\n            case Constants.FieldTypes.DropDown:\r\n                if(dynamicDataItem.FieldValue == null || dynamicDataItem.FieldValue == '')\r\n                    value = '';\r\n                else\r\n                {\r\n                    var optionValue = this.GetDropDownItem(dynamicDataItem.FieldId, dynamicDataItem.FieldValue);\r\n\r\n                    value = optionValue == null ? '???' : optionValue;\r\n                }\r\n            break;\r\n            case Constants.FieldTypes.CitySelect:\r\n                value = dynamicDataItem.CityName;\r\n            break;\r\n            default:\r\n                value = dynamicDataItem.FieldValue;\r\n            break;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    AddTableRow(row, isNew, tableRowsData, uniqueId)\r\n    {\r\n        var tableRows = (tableRowsData === null ? this.state.TableRows : tableRowsData);\r\n\r\n        if(this.HasRecordValue(row) == false)\r\n            return tableRows;\r\n        var columns = [];\r\n        \r\n        if(tableRows == null)\r\n            tableRows = [];\r\n\r\n        columns.push(new TableItem(UID_Name, uniqueId, new RecordState(isNew, null, null)));\r\n        row.forEach(column =>\r\n        {\r\n            if(column.FieldTypeId == Constants.FieldTypes.FileUploader || column.FieldTypeId == Constants.FieldTypes.ImageUploader)\r\n                return;\r\n            var value = this.GetFieldValue(column);\r\n\r\n            columns.push(new TableItem(column.FieldId, value, { RequestFormId: column.RequestFormId }));\r\n        });\r\n        tableRows.push(columns);\r\n\r\n        return tableRows;\r\n    }\r\n\r\n    AddFormData(ignore_Validation, vFormData, vTableRows)\r\n    {\r\n        if(this.defaultFormData.isMulti === true && ignore_Validation === true)\r\n            return;\r\n        if(ignore_Validation === false && this.IsFormValid() === false)\r\n            return;\r\n        var formsData = (vFormData == null ? this.state.FormsData : vFormData);\r\n        var stateData = {};\r\n        var fields = this.GetFormFields();\r\n        var id = this.state[ReviseRecordId_Key];\r\n\r\n        if(id != null)\r\n        {\r\n            var tableRows = (vTableRows === null ? this.state.TableRows : vTableRows);\r\n            var tableRow = tableRows.filter(rw => this.GetRowId(rw) == id);\r\n            var formData = formsData.DynamicFormItems.filter(fd => fd[0].UniqueId == id);\r\n\r\n            if(formData == null || formData.length <= 0)\r\n            {\r\n                Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات فرم جهت ویرایش پیدا نشد');            \r\n                return;\r\n            }\r\n            if(tableRow == null || tableRow.length <= 0)\r\n            {\r\n                Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات جدول جهت ویرایش پیدا نشد');            \r\n                return;\r\n            }\r\n            fields.forEach(field =>\r\n            {\r\n                if(field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader)\r\n                    return;\r\n                var srd = formData[0].filter(rd => rd.FieldId == field.fieldId);\r\n                var crd = tableRow[0].filter(rd => rd.name == field.fieldId);\r\n\r\n                if(srd == null || srd.length <= 0)\r\n                {\r\n                    Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات فیلد جهت ویرایش پیدا نشد');\r\n                    return;\r\n                }\r\n                if(crd == null || crd.length <= 0)\r\n                {\r\n                    Helpers.DisplayWarningMessage(this.notificationSystem, null, 'فیلد جدول جهت ویرایش پیدا نشد');            \r\n                    return;\r\n                }\r\n                var fieldValue = null;\r\n            \r\n                if(field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader)\r\n                        fieldValue = \"\";\r\n                else\r\n                    fieldValue = this.state[field.fieldId];\r\n\r\n                srd[0].FieldValue = fieldValue;\r\n                srd[0].CityName = this.GetCityName(field.fieldId, field.cityName);\r\n                crd[0].value = this.GetFieldValue(srd[0]);\r\n            });\r\n            formsData.DynamicFormItems = formsData.DynamicFormItems.filter(fd => fd[0].UniqueId != id);\r\n            formsData.DynamicFormItems.push(formData[0]);\r\n\r\n            tableRows = tableRows.filter(rw => this.GetRowId(rw) != id);\r\n            tableRows.push(tableRow[0]);\r\n\r\n            stateData[ReviseRecordId_Key] = null;\r\n            stateData[UpdateKey_Key] = this.state.updateKey + 1;\r\n            stateData[FormsData_Key] = formsData;\r\n            stateData[TableRows_Key] = tableRows;\r\n\r\n            fields.forEach(field => stateData[field.fieldId] = null);\r\n            this.setState(stateData);\r\n            return;\r\n        }\r\n        \r\n        var row = [];\r\n        var uId = this.U_Id++;\r\n\r\n        fields.forEach(field =>\r\n        {\r\n            var fieldValue = null;\r\n            \r\n            if(field.typeId === Constants.FieldTypes.FileUploader || field.typeId == Constants.FieldTypes.ImageUploader)\r\n                fieldValue = \"\";\r\n            else\r\n                fieldValue = this.state[field.fieldId];\r\n            row.push(new DynamicFormItem(field.fieldId,\r\n                                            fieldValue,\r\n                                            \"\",\r\n                                            field.typeId,\r\n                                            (this.defaultFormData.isMulti === true ? null : field.requestFieldId),\r\n                                            (this.defaultFormData.isMulti === true ? null : field.requestFormId),\r\n                                            (this.defaultFormData.isMulti === true ? true : field.requestFieldId === null),\r\n                                            this.GetCityName(field.fieldId, field.cityName),\r\n                                            uId));\r\n\r\n        });\r\n        formsData.DynamicFormItems.push(row);\r\n        if(this.defaultFormData.isMulti === false)\r\n        {\r\n            this.setState({ [FormsData_Key]: formsData });\r\n            return;\r\n        }\r\n        fields.forEach(field => stateData[field.fieldId] = null);\r\n        stateData[FormsData_Key] = formsData;\r\n        stateData[TableRows_Key] = this.AddTableRow(row, true, vTableRows, uId);\r\n        stateData[UpdateKey_Key] = this.state.updateKey + 1;\r\n\r\n        this.setState(stateData);\r\n    }\r\n\r\n    HasFileOrImageUpload()\r\n    {\r\n        return this.GetFormFields().filter(fld => fld.typeId === Constants.FieldTypes.FileUploader || fld.typeId == Constants.FieldTypes.ImageUploader).length >= 1;\r\n    }\r\n\r\n    ShowHideUploadDownloadPage(row, target)\r\n    {\r\n        var requestFormId = null;\r\n\r\n        if(this.RequestFormId == null)\r\n        {\r\n            if(row.length != null)\r\n                row.forEach(col =>\r\n                    {\r\n                        if(requestFormId != null)\r\n                            return;\r\n                        if(col.ExtraData != null && col.ExtraData.RequestFormId != null)\r\n                            requestFormId = col.ExtraData.RequestFormId;\r\n                    });\r\n        }\r\n        else\r\n            requestFormId = this.RequestFormId;\r\n        if(requestFormId == null)\r\n        {\r\n            Helpers.DisplayWarningMessage(this.notificationSystem, null, 'ابتدا اطلاعات فرم را ذخیره نمایید و سپس فرم \"دانلود / آپلود\" را باز نمایید');\r\n            return;\r\n        }\r\n        var finalTarget = target == null ? \"_blank\" : target;\r\n\r\n        window.open(GetUrl(\"dynamicUploadDownloadPage/\" + this.props.requestId + \"/\" + requestFormId), finalTarget);\r\n    }\r\n\r\n    SetTableRowOptions()\r\n    {\r\n        var rowOptions = [];\r\n\r\n        rowOptions.push({ title: 'ویرایش', icon:'edit', func: this.EditFormData });\r\n        if(this.HasFileOrImageUpload())\r\n            rowOptions.push({ title:'دانلود / آپلود', icon:'download', func: this.ShowHideUploadDownloadPage });\r\n        \r\n        return rowOptions;\r\n    }\r\n\r\n    GetCityName(filedId, cityName)\r\n    {\r\n        var record = this.SelectedAutoCompleteItems.filter(rd => rd.FieldId == filedId);\r\n\r\n        if(record.length == 1)\r\n            return record[0].Item.label;\r\n        if(cityName != null || cityName != '')\r\n            return cityName;\r\n        return '???';\r\n    }\r\n\r\n    onAutoCompleteItemSelected(fieldId, item)\r\n    {\r\n        this.SelectedAutoCompleteItems = this.SelectedAutoCompleteItems.filter(rd => rd.FieldId != fieldId);\r\n        this.SelectedAutoCompleteItems.push({ FieldId: fieldId, Item: item });\r\n\r\n        var selectedCityList = this.state[SelectedCityList_Key];\r\n        var city = selectedCityList.filter(cty => cty.value == item.value);\r\n\r\n        if(city != null && city.length >= 1)\r\n            return;\r\n        selectedCityList.push(item);\r\n        this.setState({ [SelectedCityList_Key]: selectedCityList });\r\n    }\r\n\r\n    EditFormData(row)\r\n    {\r\n        if(row == null || row.length <= 0)\r\n        {\r\n          Helpers.DisplayWarningMessage(this.notificationSystem, null, \"اطلاعات فرم پیدا نشد\");\r\n          return;\r\n        }\r\n        var id = this.GetRowId(row);\r\n        this.ReviseId = id;\r\n\r\n        var formData = this.state.FormsData.DynamicFormItems.filter(fd => fd[0].UniqueId == id);\r\n        var state = {};\r\n\r\n        if(formData == null || formData.length <= 0)\r\n        {\r\n            Helpers.DisplayWarningMessage(this.notificationSystem, null, 'اطلاعات فرم پیدا نشد');            \r\n            return;\r\n        }\r\n        this.GetFormFields().forEach(field =>\r\n        {\r\n            var fieldData = formData[0].filter(fld => fld.FieldId ==  field.fieldId);\r\n\r\n            if(fieldData == null || fieldData.length <= 0)\r\n            {\r\n                Helpers.DisplayWarningMessage(this.notificationSystem, null, 'مقدار فیلد در حالت ویرایش پیدا نشد');\r\n                return;\r\n            }\r\n            if(field.typeId === Constants.FieldTypes.DatePicker && fieldData[0].FieldValue != null && fieldData[0].FieldValue != \"\")\r\n                state[field.fieldId] = this.ParseDateValue(fieldData[0].FieldValue);\r\n            else\r\n                state[field.fieldId] = fieldData[0].FieldValue;\r\n        });\r\n        state[UpdateKey_Key] = this.state.updateKey + 1;\r\n        state[ReviseRecordId_Key] = id;\r\n        this.setState(state);\r\n    }\r\n\r\n    render()\r\n    {\r\n        if(this.defaultFormData == null)\r\n            return;\r\n        var controls = [];\r\n        \r\n        this.GetFormFields().sort((a, b) => a.order - b.order).forEach((ctl) =>\r\n        {\r\n            if(ctl.typeId === Constants.FieldTypes.FileUploader || ctl.typeId == Constants.FieldTypes.ImageUploader)\r\n                return;\r\n            controls.push(<DynamicControlSection\r\n                key={ ctl.fieldId }\r\n                parentContext={ this }\r\n                context={ this }\r\n                parentNotificationSystem={ this.notificationSystem }\r\n                onAutoCompleteItemSelected={ this.onAutoCompleteItemSelected }\r\n                offLineAutoCompleteList={ this.state.SelectedCityList }\r\n                data={ ctl } />);\r\n        });\r\n        if(this.defaultFormData.isMulti)\r\n        {\r\n            controls.push(<Delimiter key='dl001' />);\r\n            controls.push(<CellContainer lgCol={ 12 } borderRightColor=\"info\" key='cc001'>\r\n                                <div className=\"row\">\r\n                                    <div className=\"col p-2\">\r\n                                        <a className=\"btn btn-sm btn-outline-primary float-end\" onClick={ () => this.AddFormData(false, null, null) }>\r\n                                            <i className=\"ti me-2 ti-circle-plus\" />{ this.state[ReviseRecordId_Key] == null ? \"افزودن\" : \"ویرایش\" }\r\n                                        </a>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"row\">\r\n                                    <div className=\"col align-self-center\">\r\n                                        <Table hasDeleteButton\r\n                                            headers={ this.CreateTableHeaders() }\r\n                                            data={ this.state.TableRows }\r\n                                            lgCol={ 12 }\r\n                                            rowOptions={ this.SetTableRowOptions() }\r\n                                            minHeightTableWrapper={ 200 }\r\n                                            onDeleteButton={ this.DeleteFormData } />\r\n                                    </div>\r\n                                </div>\r\n                         </CellContainer>);\r\n        }\r\n        else\r\n        {\r\n            if(this.HasFileOrImageUpload())\r\n                controls.push(\r\n                        <div className=\"row\" key=\"divUD\">\r\n                            <div className=\"col-md-12 col-mg-12\">\r\n                                <button type=\"button\" className=\"btn btn-light position-relative float-end\" style={{\"width\": \"120px\"}} onClick={ this.ShowHideUploadDownloadPage }>\r\n                                    دانلود / آپلود\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n            )\r\n        }\r\n        return (\r\n            <>\r\n                <Card context={ this }\r\n                    title={ this.props.title }\r\n                    submitUrl=\"/api/FRQST/Form/SaveDynamicFormData\"\r\n                    hasBackButton\r\n                    hasDefaultSaveButton={ this.state.SaveButtonEnabled }\r\n                    statusColor=\"success\"\r\n                    updateKey={ this.state.updateKey }\r\n                    onSubmitError={ this.onSubmitError }\r\n                    onBeforeSubmit={ this.onBeforeSubmit }\r\n                    onSubmitSuccess={ this.onSubmitSuccess }\r\n                    // ToDo: Complete the old form pages\r\n                    //topButtons={[{ title: \"استفاده از اطلاعات فرم های قدیمی\", icon: \"forms\", color: \"outline-success\", url: GetUrl(\"approvedFormData\") } ]}\r\n                    ignoreValidation={ this.defaultFormData.isMulti ? true : false }>\r\n                        { controls }                        \r\n                </Card>\r\n                <NotificationSystem ref={ this.notificationSystem } />\r\n            </>\r\n        );\r\n    }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}