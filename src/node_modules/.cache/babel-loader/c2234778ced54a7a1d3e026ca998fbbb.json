{"ast":null,"code":"import _classCallCheck from\"D:/Projects/React/CMI/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"D:/Projects/React/CMI/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"D:/Projects/React/CMI/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"D:/Projects/React/CMI/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"D:/Projects/React/CMI/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Component}from\"react\";import React from\"react\";import{AutoComplete,Card,TextBox,Helpers,FileUploader,DropDown,Table}from\"core\";import{HandleError,GetUrl}from\"../utils/generals\";import NotificationSystem from\"react-notification-system\";import{typeDataEntryOptions,checkDataIsValid,isActiveOptions}from\"../utils/selectOptionUtils\";import{afraMethodUrls}from\"../utils/constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DistanceSection=/*#__PURE__*/function(_Component){_inherits(DistanceSection,_Component);var _super=_createSuper(DistanceSection);function DistanceSection(props){var _this;_classCallCheck(this,DistanceSection);_this=_super.call(this,props);_this.isNew=_this.props.isNew;_this.state={id:_this.props.id,formData:{},isLoaded:false,isConvert:\"false\",updateKey:1,updateErrorKey:1,errorList:[]};_this.pageInfo={title:\"ثبت مسافت\",icon:\"circle-plus\"};_this.notificationSystem=/*#__PURE__*/React.createRef();_this.onSubmitError=_this.onSubmitError.bind(_assertThisInitialized(_this));return _this;}_createClass(DistanceSection,[{key:\"onSubmitError\",value:function onSubmitError(errorResponse){return HandleError(Helpers,this.notificationSystem,errorResponse);}},{key:\"componentDidMount\",value:function componentDidMount(){if(!this.isNew&&this.props.item!=null){this.setState(this.props.item);this.setState({isLoaded:true});}}},{key:\"onBeforeSubmit\",value:function onBeforeSubmit(){this.setState({errorList:[],updateErrorKey:this.state.updateErrorKey+1});if(this.state.isConvert==\"false\")if(isNaN(this.state.value)||this.state.value<=0){Helpers.DisplayErrorMessage(this.notificationSystem,null,\"مقدار مسافت صحیح نمی باشد\");return false;}var formData=this.state.formData;formData[\"fromUnit\"]=this.state.fromUnit;formData[\"id\"]=this.id;formData[\"toRegion\"]=this.state.toRegion;formData[\"toUnit\"]=this.state.toUnit;formData[\"value\"]=this.state.value;formData[\"files\"]=this.state.files;formData[\"isConvert\"]=this.state.isConvert;this.setState({formData:formData});return true;}},{key:\"onChangeIsConvert\",value:function onChangeIsConvert(e){if(e.value){this.setState({files:null,filesIsValid:true,filesValidFeedBack:\"\",fromUnit:null,fromUnitIsValid:true,fromUnitValidFeedBack:\"\",toRegion:null,toRegionIsValid:true,toRegionValidFeedBack:\"\",toUnit:null,toUnitIsValid:true,toUnitValidFeedBack:\"\",value:null,valueIsValid:true,valueValidFeedBack:\"\",errorList:[]// updateKey: this.state.updateKey + 1,\n});}return true;}},{key:\"onSubmitSuccess\",value:function onSubmitSuccess(e){if(checkDataIsValid(e)){if(this.isNew){if(e.data.errorList==null){Helpers.DisplaySuccessMessage(this.notificationSystem,\" اطلاعات با موفقیت ثبت شد .....\");//   window.location.href = GetUrl(\"distanceListPage\");\nthis.setState({files:null,filesIsValid:true,filesValidFeedBack:\"\",fromUnit:null,fromUnitIsValid:true,fromUnitValidFeedBack:\"\",toUnit:null,toUnitIsValid:true,toUnitValidFeedBack:\"\",toRegion:null,toRegionIsValid:true,toRegionValidFeedBack:\"\",value:null,valueIsValid:true,valueValidFeedBack:\"\",updateKey:this.state.updateKey+1});}else if(e.data.errorList.length==0){Helpers.DisplaySuccessMessage(this.notificationSystem,\"درخواست با موفقیت انجام شد ، در حال انتقال به فهرست مسافت های ثبت شده .....\");window.location.href=GetUrl(\"distanceListPage\");}else{var errorList=[];for(var index=0;index<e.data.errorList.length;index++){errorList.push([{name:\"error\",value:e.data.errorList[index]}]);}this.setState({errorList:errorList,updateErrorKey:this.state.updateErrorKey+1});}}else{Helpers.DisplaySuccessMessage(this.notificationSystem,\"درخواست با موفقیت انجام شد ، در حال انتقال به فهرست مسافت های ثبت شده .....\");window.location.href=GetUrl(\"distanceListPage\");}}else{Helpers.DisplayErrorMessage(this.notificationSystem,\"در پردازش درخواست مشکلی پیش آمده است\");}}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(_Fragment,{children:[(this.isNew||this.state.isLoaded)&&/*#__PURE__*/_jsxs(Card,{context:this,title:\"\\u0645\\u0634\\u062E\\u0635\\u0627\\u062A \\u0645\\u0633\\u0627\\u0641\\u062A\",submitUrl:this.isNew?\"/api/CMI/Distance/Post\":\"/api/CMI/Distance/Update\",hasBackButton:true,statusColor:\"primary\",onSubmitError:this.onSubmitError,onSubmitSuccess:function onSubmitSuccess(e){return _this2.onSubmitSuccess(e);},onBeforeSubmit:function onBeforeSubmit(e){return _this2.onBeforeSubmit(e);},hasDefaultSaveButton:true,formData:this.state.formData//   key={this.state.updateKey + 1}\n,children:[/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:this.isNew?/*#__PURE__*/_jsx(DropDown,{context:this,name:\"isConvert\",initialValue:\"false\",title:\"\\u0646\\u0648\\u0639 \\u0648\\u0631\\u0648\\u062F \\u0627\\u0637\\u0644\\u0627\\u0639\\u0627\\u062A\",options:typeDataEntryOptions(),changeHandler:function changeHandler(e){return _this2.onChangeIsConvert(e);},notificationSystem:this.notificationSystem,updateKey:this.state.updateKey+1}):null}),!this.isNew||this.state.isConvert==\"false\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(AutoComplete,{context:this,name:\"fromUnit\",title:\"\\u0648\\u0627\\u062D\\u062F \\u0645\\u0628\\u062F\\u0627\",remoteUrl:afraMethodUrls.getOfficesAndBranchManagements,externalData:this.isNew?[]:[{label:this.props.item.fromUnitTitle,value:this.props.item.fromUnit}],required:true,lgCol:4,notificationSystem:this.notificationSystem},\"from\"+this.state.updateKey+1),/*#__PURE__*/_jsx(AutoComplete,{context:this,name:\"toRegion\",title:\"\\u0645\\u0646\\u0637\\u0642\\u0647 \\u0645\\u0642\\u0635\\u062F\",remoteUrl:afraMethodUrls.getRegionAll,externalData:this.isNew?[]:[{label:this.props.item.toRegionTitle,value:this.props.item.toRegion}],required:true,lgCol:4,notificationSystem:this.notificationSystem},\"to\"+this.state.updateKey+1),/*#__PURE__*/_jsx(AutoComplete,{context:this,name:\"toUnit\",title:\"\\u0634\\u0639\\u0628\\u0647 \\u0645\\u0642\\u0635\\u062F\",remoteUrl:afraMethodUrls.getUnitAll,externalData:this.isNew?[]:[{label:this.props.item.toUnitTitle,value:this.props.item.toUnit}],required:true,lgCol:4,notificationSystem:this.notificationSystem},\"to\"+this.state.updateKey+1),/*#__PURE__*/_jsx(TextBox,{context:this,name:\"value\",title:\"\\u0645\\u0633\\u0627\\u0641\\u062A(\\u0628\\u0631\\u062D\\u0633\\u0628 \\u06A9\\u06CC\\u0644\\u0648\\u0645\\u062A\\u0631)\",maxLength:5,validateHandler:[Helpers.NumberTypeValidator,Helpers.MaxLengthValidator],required:true,lgCol:4},\"value\"+this.state.updateKey+1)]}):null,/*#__PURE__*/_jsx(DropDown,{context:this,name:\"isActive\",title:\"\\u0648\\u0636\\u0639\\u06CC\\u062A\",required:true,options:isActiveOptions(),initialValue:\"true\"}),this.state.isActive==\"false\"&&/*#__PURE__*/_jsx(TextBox,{context:this,name:\"deactivationDate\",title:\"\\u062A\\u0627\\u0631\\u06CC\\u062E \\u063A\\u06CC\\u0631\\u0641\\u0639\\u0627\\u0644 \\u0633\\u0627\\u0632\\u06CC\",initialValue:this.props.record?this.state.deactivationDate:this.props.todayDateShamsi,readOnly:true}),this.state.isConvert==\"true\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FileUploader,{context:this,name:\"files\",title:\"\\u0628\\u0627\\u0631\\u06AF\\u0632\\u0627\\u0631\\u06CC \\u0627\\u0637\\u0644\\u0627\\u0639\\u0627\\u062A\",validExtensions:[\".xlsx\"],lgCol:4,required:true}),/*#__PURE__*/_jsx(Table,{headers:[{title:\"خطا\",name:\"error\"}],data:this.state.errorList,minHeightTableWrapper:200},\"errorTbl\"+this.state.updateErrorKey)]}):null]}),/*#__PURE__*/_jsx(NotificationSystem,{ref:this.notificationSystem})]});}}]);return DistanceSection;}(Component);export default DistanceSection;","map":null,"metadata":{},"sourceType":"module"}