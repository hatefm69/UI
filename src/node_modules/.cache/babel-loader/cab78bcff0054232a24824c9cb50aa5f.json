{"ast":null,"code":"import _classCallCheck from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Component}from\"react\";import{Helpers,SimpleGrid}from\"core\";import Constants from'../utils/constants';import{GetUrl,HandleError}from'../utils/generals';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var RequestListSection=/*#__PURE__*/function(_Component){_inherits(RequestListSection,_Component);var _super=_createSuper(RequestListSection);function RequestListSection(props){var _this;_classCallCheck(this,RequestListSection);_this=_super.call(this,props);_this.state={};_this.showMessage=_this.showMessage.bind(_assertThisInitialized(_this));_this.closeRequest=_this.closeRequest.bind(_assertThisInitialized(_this));_this.getMoreInfoLinks=_this.getMoreInfoLinks.bind(_assertThisInitialized(_this));return _this;}// Events.\n_createClass(RequestListSection,[{key:\"downloadFile\",value:function downloadFile(record,url){if(record==null||record.id==null||record.id==\"\"){Helpers.DisplayErrorMessage(this.props.notificationSystem,null,'شناسه درخواست پیدا نشد');return;}var wm=window.open(GetUrl(\"\".concat(url,\"/\").concat(record.id)),\"_target\");wm.focus();wm.onblur=function(){wm.close();};}},{key:\"showHideMessage\",value:function showHideMessage(item){return item.errorMessage!=null&&item.errorMessage!=\"\";}},{key:\"showMessage\",value:function showMessage(item){Helpers.DisplayErrorMessage(this.props.notificationSystem,null,item.errorMessage);}},{key:\"closeRequest\",value:function closeRequest(item){var _this2=this;if(item==null||item.id==null||item.id==\"\"){Helpers.DisplayErrorMessage(this.props.notificationSystem,null,\"شناسه درخواست جهت مختومه کردن پیدا نشد\");return;}this.setState({isLoading:true});Helpers.CallServer('/api/amls/Request/CloseRequest/'+item.id,{},function(successfulResponse){Helpers.DisplaySuccessMessage(_this2.props.notificationSystem,successfulResponse.message);},function(errorResponse){return HandleError(Helpers,_this2.props.notificationSystem,errorResponse);},function(){_this2.setState({isLoading:false});},'GET');}},{key:\"hasDownloadFile\",value:function hasDownloadFile(record){return record.statusId==Constants.RequestState.Done.Key&&record.requestTypeId!=Constants.RequestType.Registering_STR;}},{key:\"isRequestDone\",value:function isRequestDone(record){return record.statusId==Constants.RequestState.Done.Key;}},{key:\"getMoreInfoLinks\",value:function getMoreInfoLinks(){var _this3=this;var menu=[];switch(this.props.requestTypeId){case Constants.RequestType.Billing:menu.push({title:'صورتحساب شخص',icon:'receipt-2',enable:this.hasDownloadFile,url:GetUrl('personBillingListPage/#replaceWith_id#')});menu.push({title:'دانلود فایل صورتحساب',icon:'receipt-2',enable:this.hasDownloadFile,func:function func(rd){return _this3.downloadFile(rd,'downloadBillings');},url:\"\"});break;case Constants.RequestType.Roles:menu.push({title:'دانلود فایل شاخص',icon:'file-spreadsheet',enable:this.hasDownloadFile,func:function func(rd){return _this3.downloadFile(rd,'downloadIndex');},url:\"\"});break;case Constants.RequestType.Registering_STR:menu.push({title:'صورتحساب 68 ستونی مشتری',icon:'receipt-2',enable:this.isRequestDone,url:GetUrl('registerStrPersonBillings/#replaceWith_id#')});menu.push({title:'نمایش STR',icon:'license',enable:this.isRequestDone,func:function func(rd){return _this3.downloadFile(rd,'downloadRegisterSTR');},url:\"\"});break;}menu.push({title:'مختومه',icon:'row-remove',url:\"\",enable:this.hasDownloadFile,func:this.closeRequest});menu.push({title:'پیام سیستم',icon:'message',func:this.showMessage,url:\"\",divider:true,enable:this.showHideMessage});return menu;}},{key:\"render\",value:function render(){var _this4=this;return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsx(SimpleGrid,{context:this,minHeightTableWrapper:Constants.MinGridHeight,hasSearchBox:false,hideExportButton:true,filterBgColor:\"primary\",name:\"crdrqstList\",title:this.props.title,notificationSystem:this.props.notificationSystem,enableAutoFetch:true,listApiUrl:\"/api/amls/Request/SearchRequests\",extraItemsSentToFetchData:{RequestTypeId:this.props.requestTypeId},moreInfoLinks:this.getMoreInfoLinks(),headers:[{title:\"کد پرسنل\",name:\"personCode\"},{title:\"نام پرسنل\",name:\"personName\"},{title:\"تاریخ درخواست\",name:\"requestDateStr\"},{title:\"نوع درخواست\",name:\"requestTypeName\"},{title:\"وضعیت\",name:\"statusName\"},{title:\"کد خطا\",name:\"errorTrackingCode\"}],badgeOnCells:[{fieldName:\"statusName\",color:function color(x){switch(x){case Constants.RequestState.Registerd.Title:return\"gray\";case Constants.RequestState.InProcess.Title:return\"yellow\";case Constants.RequestState.Done.Title:return\"green\";case Constants.RequestState.Error.Title:return\"red\";}}}],filterOptions:[{type:'auto-complete',name:'personCode',title:'پرسنل',lookupApiUrl:\"/api/amls/DistributionOfIndicator/SearchPersonels\"},{type:\"datepicker\",name:\"startDate\",title:\"از تاریخ\",useEpoch:true},{type:\"datepicker\",name:\"endDate\",title:\"تا تاریخ\",useEpoch:true}]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:/*#__PURE__*/_jsx(\"div\",{className:\"d-flex\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"btn btn-outline-secendery ms-auto\",onClick:function onClick(e){return _this4.Backward(e);},href:\"/\",title:\"\\u0628\\u0627\\u0632\\u06AF\\u0634\\u062A \\u0628\\u0647 \\u0635\\u0641\\u062D\\u0647 \\u0642\\u0628\\u0644\",children:[\"\\u0628\\u0627\\u0632\\u06AF\\u0634\\u062A\",/*#__PURE__*/_jsx(\"i\",{className:\"ti ti-arrow-left ms-1\"})]})})})]})});}}]);return RequestListSection;}(Component);export{RequestListSection as default};","map":null,"metadata":{},"sourceType":"module"}