{"ast":null,"code":"import _defineProperty from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _classCallCheck from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"D:/Projects/React/AMLS/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Card,AutoComplete,DatePicker,Table,PageMain,Helpers,DropDown}from\"core\";import React from\"react\";import NotificationSystem from\"react-notification-system\";import Constants from\"../../utils/constants\";import{HandleError,IsValid}from'../../utils/generals';import TableItem from'../../models/tableItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Controls={PersonCode:\"personCode\",RoleCode:\"roleCode\",ExpirationDateFrom:\"expirationDateFrom\"};var ButtonWidth={\"width\":\"100px\"};var DistributionOfIndicatorsPage=/*#__PURE__*/function(_React$Component){_inherits(DistributionOfIndicatorsPage,_React$Component);var _super=_createSuper(DistributionOfIndicatorsPage);function DistributionOfIndicatorsPage(props){var _this;_classCallCheck(this,DistributionOfIndicatorsPage);_this=_super.call(this,props);_this.state={isLoading:true,indexes:null,personIndexes:[],updateKey:1,records:[],laodTable:true};_this.notificationSystem=/*#__PURE__*/React.createRef();_this.RowIndex=1;_this.Role=null;_this.person=null;_this.onPersonSelected=_this.onPersonSelected.bind(_assertThisInitialized(_this));_this.LoadTable=_this.LoadTable.bind(_assertThisInitialized(_this));_this.onPersonIndexAdd=_this.onPersonIndexAdd.bind(_assertThisInitialized(_this));_this.onRoleSelected=_this.onRoleSelected.bind(_assertThisInitialized(_this));_this.isRecordExist=_this.isRecordExist.bind(_assertThisInitialized(_this));_this.onPersonChange=_this.onPersonChange.bind(_assertThisInitialized(_this));_this.onBeforeSubmit=_this.onBeforeSubmit.bind(_assertThisInitialized(_this));_this.onDeletePersonIndex=_this.onDeletePersonIndex.bind(_assertThisInitialized(_this));return _this;}_createClass(DistributionOfIndicatorsPage,[{key:\"GetTableRow\",value:function GetTableRow(record){console.log(\"Record: \",record);var tableColumns=[];var extraData={Id:record.id,ExpirationDateFrom:record.expirationDateFrom,Index:this.RowIndex};var sRecord={id:record.id,personCode:record.personCode,indexId:record.indexId,expirationDateFrom:record.expirationDateFrom,Index:this.RowIndex};//tableColumns.push(new TableItem(Controls.RoleCode, record.roleCode, extraData));\ntableColumns.push(new TableItem(\"roleName\",record.roleName,extraData));tableColumns.push(new TableItem(\"solarExpirationDateFrom\",record.solarExpirationDateFrom,extraData));this.RowIndex++;return{TableRow:tableColumns,Record:sRecord};}},{key:\"LoadTable\",value:function LoadTable(records){var _this2=this;if(this.state.laodTable==false)return;var personIndexes=[];var sRecords=[];this.RowIndex=1;if(records==null){this.setState({personIndexes:personIndexes});return;}records.forEach(function(record){var row=_this2.GetTableRow(record);personIndexes.push(row.TableRow);sRecords.push(row.Record);});this.setState({personIndexes:personIndexes,records:sRecords,laodTable:false,updateKey:this.state.updateKey+1});}},{key:\"isRecordExist\",value:function isRecordExist(personCode,roleCode){var records=this.state.records;var result=records.filter(function(rd){return rd.personCode==personCode&&rd.roleCode==roleCode;});if(result!=null&&result.length>=1)return true;return false;}// Events.\n},{key:\"componentDidMount\",value:function componentDidMount(){var _this3=this;Helpers.CallServer('/api/amls/DistributionOfIndicator/GetAllIndexes',{},function(successfulResponse){_this3.setState({indexes:successfulResponse.data});},function(errorResponse){return HandleError(Helpers,_this3.notificationSystem,errorResponse);},function(){_this3.setState({isLoading:false});},'GET');}},{key:\"onPersonSelected\",value:function onPersonSelected(item){var _this4=this;if(item==null||item.value==null||item.value==\"\"){this.person=null;this.LoadTable([]);return;}var personCode=item.value;this.person=item;Helpers.CallServer('/api/amls/DistributionOfIndicator/GetPersonDistributionOfIndicators/'+personCode,{},function(successfulResponse){_this4.LoadTable(successfulResponse.data);},function(errorResponse){return HandleError(Helpers,_this4.notificationSystem,errorResponse);},function(){_this4.setState({isLoading:false});},'GET');}},{key:\"onPersonIndexAdd\",value:function onPersonIndexAdd(){if(!IsValid(Controls.PersonCode,this.state,Helpers,this.notificationSystem))return;if(!IsValid(Controls.RoleCode,this.state,Helpers,this.notificationSystem))return;if(!IsValid(Controls.ExpirationDateFrom,this.state,Helpers,this.notificationSystem))return;if(this.Role==null){Helpers.DisplayErrorMessage(this.notificationSystem,null,'اطلاعات قواعد انتخاب شده پیدا نشد');return;}var expirationDateFrom=this.state[Controls.ExpirationDateFrom];var record={id:null,personCode:this.state[Controls.PersonCode],indexId:this.state[Controls.RoleCode],roleName:this.Role.label,expirationDateFrom:expirationDateFrom,solarExpirationDateFrom:Helpers.ToPersianJustDate(expirationDateFrom)};if(this.isRecordExist(record.personCode,record.indexId)){Helpers.DisplayErrorMessage(this.notificationSystem,null,'این داده تکراری می باشد');return;}var personIndexes=this.state.personIndexes;var records=this.state.records;var row=this.GetTableRow(record);personIndexes.push(row.TableRow);records.push(row.Record);this.setState({personIndexes:personIndexes,records:records,roleCode:null,expirationDateFrom:null,updateKey:this.state.updateKey+1,laodTable:false});}},{key:\"onRoleSelected\",value:function onRoleSelected(item){if(item==null||item.value==null||item.value==\"\"){this.Role=null;return;}this.Role=item;}},{key:\"onPersonChange\",value:function onPersonChange(){var _this$setState;this.RowIndex=1;this.Role=null;this.person=null;this.setState((_this$setState={},_defineProperty(_this$setState,Controls.PersonCode,null),_defineProperty(_this$setState,Controls.RoleCode,null),_defineProperty(_this$setState,Controls.ExpirationDateFrom,null),_defineProperty(_this$setState,\"personIndexes\",[]),_defineProperty(_this$setState,\"laodTable\",true),_defineProperty(_this$setState,\"updateKey\",this.state.updateKey+1),_this$setState));}},{key:\"onBeforeSubmit\",value:function onBeforeSubmit(){var records=this.state.records;var newRecords=[];records.forEach(function(rd){if(rd.id==null)newRecords.push(rd);});if(newRecords.length<=0){Helpers.DisplayErrorMessage(this.notificationSystem,null,'هیچ قواعد جدیدی به پرسنل داده نشده است');return false;}return true;}},{key:\"onDeletePersonIndex\",value:function onDeletePersonIndex(option){var _this5=this;var row=option.modalData;var tableRowExtraData=row[0].ExtraData;var records=this.state.records;var personIndexes=this.state.personIndexes;var index=tableRowExtraData.Index;personIndexes=personIndexes.filter(function(rd){return rd[0].ExtraData.Index!=index;});records=records.filter(function(rd){return rd.Index!=index;});if(tableRowExtraData.Id!=null){this.setState({isLoading:true});Helpers.CallServer('/api/amls/DistributionOfIndicator/DeleteDistributionOfIndicator/'+tableRowExtraData.Id,{},function(successfulResponse){option.modalOpen=false;_this5.setState({personIndexes:personIndexes,records:records,updateKey:_this5.state.updateKey+1});},function(errorResponse){return HandleError(Helpers,_this5.notificationSystem,errorResponse);},function(){_this5.setState({isLoading:false});},'GET');}else{option.modalOpen=false;this.setState({personIndexes:personIndexes,records:records,updateKey:this.state.updateKey+1});}}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageMain,{title:\"\\u062A\\u0648\\u0632\\u06CC\\u0639 \\u0642\\u0648\\u0627\\u0639\\u062F\",icon:\"chart-line\",footerLinks:[{href:\"/\",text:\"صفحه اصلی\"}],isLoading:this.state.isLoading,topButtons:[],children:this.state.indexes&&/*#__PURE__*/_jsxs(Card,{context:this,title:\"\\u062C\\u0632\\u0626\\u06CC\\u0627\\u062A \\u062A\\u0648\\u0632\\u06CC\\u0639 \\u0642\\u0648\\u0627\\u0639\\u062F\",icon:\"chart-line\",hasDefaultSaveButton:true,hasBackButton:true,statusColor:\"primary\",submitUrl:\"/api/amls/DistributionOfIndicator/AddDistributionOfIndicators\",submitFields:\"records\",onBeforeSubmit:this.onBeforeSubmit,children:[/*#__PURE__*/_jsx(AutoComplete,{context:this,name:Controls.PersonCode,title:\"\\u067E\\u0631\\u0633\\u0646\\u0644\",required:true,remoteUrl:\"/api/amls/DistributionOfIndicator/SearchPersonels\",changeHandler:this.onPersonSelected,disabled:this.state.laodTable?false:true,externalData:this.person==null?[]:[{label:this.person.label,value:this.person.value}]}),/*#__PURE__*/_jsx(DropDown,{context:this,name:Controls.RoleCode,title:\"\\u0642\\u0648\\u0627\\u0639\\u062F\",options:this.state.indexes,required:true,changeHandler:this.onRoleSelected}),/*#__PURE__*/_jsx(DatePicker,{context:this,name:Controls.ExpirationDateFrom,title:\"\\u062A\\u0627\\u0631\\u06CC\\u062E \\u0627\\u0639\\u062A\\u0628\\u0627\\u0631 \\u0627\\u0632\",useEpoch:true,required:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-10\"}),/*#__PURE__*/_jsx(\"div\",{className:\"col-1 p-2\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"btn btn-sm btn-outline-primary float-end\",onClick:this.onPersonIndexAdd,style:ButtonWidth,children:[/*#__PURE__*/_jsx(\"i\",{className:\"ti me-2 ti-circle-plus\"}),\"\\u0627\\u0641\\u0632\\u0648\\u062F\\u0646\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-1 p-2\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"btn btn-sm btn-outline-primary float-end\",onClick:this.onPersonChange,style:ButtonWidth,children:[/*#__PURE__*/_jsx(\"i\",{className:\"ti me-2 ti-exchange ml-5\"}),\"\\u062A\\u063A\\u06CC\\u06CC\\u0631 \\u067E\\u0631\\u0633\\u0646\\u0644\"]})})]}),/*#__PURE__*/_jsx(Table,{minHeightTableWrapper:Constants.MinGridHeight,data:this.state.personIndexes,hasDeleteButton:true,onDeleteButton:this.onDeletePersonIndex,headers:[//{ title: \"کد قواعد\", name: Controls.RoleCode },\n{title:\"نام قواعد\",name:\"roleName\"},{title:\"تاریخ اعتبار از\",name:\"solarExpirationDateFrom\"}]})]},this.state.updateKey)}),/*#__PURE__*/_jsx(NotificationSystem,{ref:this.notificationSystem})]});}}]);return DistributionOfIndicatorsPage;}(React.Component);export{DistributionOfIndicatorsPage as default};","map":null,"metadata":{},"sourceType":"module"}